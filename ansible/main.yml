---
- name: Getting facts
  hosts: wireguard
  become: yes
  user: "{{ user }}"
  gather_facts: true

- hosts: wireguard
  become: yes
  user: "{{ user }}"
  roles:
  - server_install

- hosts: localhost
  vars:
    - bcbio_dir: /mnt/bcbio
    - is_macosx: "'{{ansible_distribution}}' == 'MacOSX'"

- hosts: localhost
  connection: local
  vars:
    - is_macosx: "'{{ansible_distribution}}' == 'MacOSX'"
  become: "{{ 'no' if is_macosx else 'yes' }}"
  roles:
  - client_install

- hosts: wireguard
  become: yes
  user: "{{ user }}"
  roles:
  - configure_server

- hosts: localhost
  connection: local
  vars:
    - is_macosx: "'{{ansible_distribution}}' == 'MacOSX'"
  become: "{{ 'no' if is_macosx else 'yes' }}"
  roles:
  - configure_client
